name: Deploy to NuGet

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+' # Triggers on tags like v1.0.0, v2.1.5, etc.

jobs:
  deploy:
    runs-on: ubuntu-latest # Using a Linux runner, as indicated by your error log

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x' # Specifies the .NET 8 SDK

    - name: Build and Pack
      run: dotnet pack FAST.FBasicInterpreter/FAST.FBasicInterpreter.csproj --configuration Release -p:PackageVersion=${{github.ref_name}} --output nupkg
      # The previous command failed because the project path started with a '/', which MSBuild on Linux
      # incorrectly interpreted as an unknown command-line switch. This command uses a correct relative path.

    - name: Push package to NuGet
      run: dotnet nuget push "nupkg/*.nupkg" --api-key ${{ secrets.NUGET_API_KEY }} --source https://api.nuget.org/v3/index.json